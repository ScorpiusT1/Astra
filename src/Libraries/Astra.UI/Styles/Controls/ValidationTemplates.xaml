<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">

    <!-- 验证错误模板 -->
    <ControlTemplate x:Key="ValidationErrorTemplate">
        <Grid>
            <AdornedElementPlaceholder x:Name="adorner" />

            <!-- 错误指示器 -->
            <Border BorderBrush="{DynamicResource DangerBrush}"
                    BorderThickness="2"
                    CornerRadius="3"
                    IsHitTestVisible="False" />

            <!-- 错误图标 -->
            <Path Data="M12,2C6.48,2 2,6.48 2,12C2,17.52 6.48,22 12,22C17.52,22 22,17.52 22,12C22,6.48 17.52,2 12,2ZM13,17H11V15H13V17ZM13,13H11V7H13V13Z"
                  Fill="{DynamicResource DangerBrush}"
                  Width="16"
                  Height="16"
                  Stretch="Uniform"
                  HorizontalAlignment="Right"
                  VerticalAlignment="Top"
                  Margin="0,-8,-8,0"
                  IsHitTestVisible="False" />
        </Grid>
    </ControlTemplate>

    <!-- 验证警告模板 -->
    <ControlTemplate x:Key="ValidationWarningTemplate">
        <Grid>
            <AdornedElementPlaceholder x:Name="adorner" />

            <!-- 警告指示器 -->
            <Border BorderBrush="{DynamicResource WarningBrush}"
                    BorderThickness="2"
                    CornerRadius="3"
                    IsHitTestVisible="False" />

            <!-- 警告图标 -->
            <Path Data="M12,2L1,21H23M12,6L19.53,19H4.47M11,10V14H13V10M11,16V18H13V16"
                  Fill="{DynamicResource WarningBrush}"
                  Width="16"
                  Height="16"
                  Stretch="Uniform"
                  HorizontalAlignment="Right"
                  VerticalAlignment="Top"
                  Margin="0,-8,-8,0"
                  IsHitTestVisible="False" />
        </Grid>
    </ControlTemplate>

    <!-- 更新默认属性编辑器，支持验证 -->
    <DataTemplate x:Key="ValidatedPropertyEditor">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!-- 输入框 -->
            <TextBox Grid.Row="0"
                     Text="{Binding Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, 
                                    ValidatesOnNotifyDataErrors=True, NotifyOnValidationError=True}"
                     ToolTip="{Binding Description}"
                     IsReadOnly="{Binding IsReadOnly}"
                     VerticalContentAlignment="Center"
                     Padding="4,2"
                     BorderThickness="1">
                <TextBox.Style>
                    <Style TargetType="TextBox">
                        <Setter Property="BorderBrush"
                                Value="{DynamicResource BorderBrush}" />
                        <Style.Triggers>
                            <!-- 错误状态 -->
                            <DataTrigger Binding="{Binding ValidationSeverity}"
                                         Value="Error">
                                <Setter Property="BorderBrush"
                                        Value="{DynamicResource DangerBrush}" />
                                <Setter Property="BorderThickness"
                                        Value="2" />
                            </DataTrigger>
                            <!-- 警告状态 -->
                            <DataTrigger Binding="{Binding ValidationSeverity}"
                                         Value="Warning">
                                <Setter Property="BorderBrush"
                                        Value="{DynamicResource WarningBrush}" />
                                <Setter Property="BorderThickness"
                                        Value="2" />
                            </DataTrigger>
                            <!-- 信息状态 -->
                            <DataTrigger Binding="{Binding ValidationSeverity}"
                                         Value="Info">
                                <Setter Property="BorderBrush"
                                        Value="{DynamicResource PrimaryBrush}" />
                                <Setter Property="BorderThickness"
                                        Value="2" />
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </TextBox.Style>
            </TextBox>

            <!-- 错误消息 -->
            <TextBlock Grid.Row="1"
                       Text="{Binding ErrorMessage}"
                       Margin="4,2,0,0"
                       FontSize="11"
                       TextWrapping="Wrap">
                <TextBlock.Style>
                    <Style TargetType="TextBlock">
                        <Setter Property="Visibility"
                                Value="Collapsed" />
                        <Setter Property="Foreground"
                                Value="{DynamicResource SecondaryTextBrush}" />
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding ValidationSeverity}"
                                         Value="Error">
                                <Setter Property="Visibility"
                                        Value="Visible" />
                                <Setter Property="Foreground"
                                        Value="{DynamicResource DangerBrush}" />
                            </DataTrigger>
                            <DataTrigger Binding="{Binding ValidationSeverity}"
                                         Value="Warning">
                                <Setter Property="Visibility"
                                        Value="Visible" />
                                <Setter Property="Foreground"
                                        Value="{DynamicResource WarningBrush}" />
                            </DataTrigger>
                            <DataTrigger Binding="{Binding ValidationSeverity}"
                                         Value="Info">
                                <Setter Property="Visibility"
                                        Value="Visible" />
                                <Setter Property="Foreground"
                                        Value="{DynamicResource PrimaryBrush}" />
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </TextBlock.Style>
            </TextBlock>
        </Grid>
    </DataTemplate>
</ResourceDictionary>