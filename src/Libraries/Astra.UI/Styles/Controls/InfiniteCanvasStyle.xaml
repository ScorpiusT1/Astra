<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:local="clr-namespace:Astra.UI.Controls">

    <!-- InfiniteCanvas 默认样式 -->
    <Style TargetType="{x:Type local:InfiniteCanvas}">
        <!-- ✅ 使用 DynamicResource 动态绑定颜色 -->
        <Setter Property="Background"
                Value="{DynamicResource BackgroundBrush}" />
        <Setter Property="GridBrush"
                Value="{DynamicResource BorderBrush}" />
        <Setter Property="AlignmentLineBrush"
                Value="{DynamicResource SuccessBrush}" />
        <Setter Property="SelectionBorderBrush"
                Value="{DynamicResource PrimaryBrush}" />
        <Setter Property="ClipToBounds"
                Value="True" />
        <Setter Property="Focusable"
                Value="True" />

        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type local:InfiniteCanvas}">
                    <Grid Background="{TemplateBinding Background}">
                        <!-- 网格层 -->
                        <Canvas x:Name="PART_GridLayer"
                                IsHitTestVisible="False"
                                Panel.ZIndex="0" />

                        <!-- 内容层 -->
                        <Canvas x:Name="PART_ContentCanvas"
                                Panel.ZIndex="1">
                            <ItemsControl ItemsSource="{TemplateBinding ItemsSource}"
                                          ItemTemplate="{TemplateBinding ItemTemplate}">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <Canvas />
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>

                                <ItemsControl.ItemContainerStyle>
                                    <Style TargetType="ContentPresenter">
                                        <Setter Property="Canvas.Left"
                                                Value="{Binding X}" />
                                        <Setter Property="Canvas.Top"
                                                Value="{Binding Y}" />
                                    </Style>
                                </ItemsControl.ItemContainerStyle>
                            </ItemsControl>
                        </Canvas>

                        <!-- 对齐辅助线层 -->
                        <Canvas x:Name="PART_AlignmentLayer"
                                IsHitTestVisible="False"
                                Panel.ZIndex="2" />

                        <!-- 缩略图 -->
                        <Border x:Name="PART_MinimapContainer"
                                Width="{TemplateBinding MinimapWidth}"
                                Height="{TemplateBinding MinimapHeight}"
                                HorizontalAlignment="Right"
                                VerticalAlignment="Bottom"
                                Margin="12"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="4"
                                Panel.ZIndex="10"
                                Visibility="{TemplateBinding ShowMinimap, Converter={StaticResource BoolToVisConverter}}">

                            <!-- 阴影效果 -->
                            <Border.Effect>
                                <DropShadowEffect Color="{DynamicResource ShadowColor}"
                                                  BlurRadius="8"
                                                  ShadowDepth="2"
                                                  Opacity="0.15" />
                            </Border.Effect>

                            <!-- 缩略图内容 -->
                            <DockPanel>
                                <!-- 标题栏 -->
                                <Border DockPanel.Dock="Top"
                                        Height="32"
                                        Background="{DynamicResource SecondaryRegionBrush}"
                                        BorderBrush="{DynamicResource BorderBrush}"
                                        BorderThickness="0,0,0,1">
                                    <TextBlock Text="缩略图"
                                               Foreground="{DynamicResource PrimaryTextBrush}"
                                               FontSize="12"
                                               VerticalAlignment="Center"
                                               Margin="8,0" />
                                </Border>

                                <!-- 画布缩略图 -->
                                <Canvas x:Name="PART_MinimapCanvas"
                                        Background="{DynamicResource BackgroundBrush}">
                                    <!-- 视口指示器 -->
                                    <Rectangle x:Name="PART_ViewportIndicator"
                                               Stroke="{DynamicResource PrimaryBrush}"
                                               StrokeThickness="2"
                                               Fill="{DynamicResource LightPrimaryBrush}"
                                               Opacity="0.3"
                                               RadiusX="2"
                                               RadiusY="2" />
                                </Canvas>
                            </DockPanel>
                        </Border>

                        <!-- 选择框 -->
                        <Rectangle x:Name="PART_SelectionBox"
                                   Stroke="{DynamicResource PrimaryBrush}"
                                   StrokeThickness="1.5"
                                   StrokeDashArray="4 2"
                                   Fill="{DynamicResource LightPrimaryBrush}"
                                   Opacity="0.25"
                                   Visibility="Collapsed"
                                   Panel.ZIndex="5" />

                        <!-- 状态栏 -->
                        <Border VerticalAlignment="Bottom"
                                HorizontalAlignment="Left"
                                Margin="12"
                                Padding="10,6"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="4"
                                Panel.ZIndex="10">

                            <Border.Effect>
                                <DropShadowEffect Color="{DynamicResource ShadowColor}"
                                                  BlurRadius="6"
                                                  ShadowDepth="1"
                                                  Opacity="0.1" />
                            </Border.Effect>

                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="缩放: "
                                           Foreground="{DynamicResource SecondaryTextBrush}"
                                           FontSize="11" />
                                <TextBlock Text="{Binding Scale, RelativeSource={RelativeSource TemplatedParent}, StringFormat={}{0:P0}}"
                                           Foreground="{DynamicResource PrimaryTextBrush}"
                                           FontSize="11"
                                           FontWeight="Medium" />

                                <Rectangle Width="1"
                                           Height="12"
                                           Fill="{DynamicResource BorderBrush}"
                                           Margin="8,0" />

                                <TextBlock Text="节点: "
                                           Foreground="{DynamicResource SecondaryTextBrush}"
                                           FontSize="11" />
                                <TextBlock x:Name="PART_NodeCountText"
                                           Text="0"
                                           Foreground="{DynamicResource PrimaryTextBrush}"
                                           FontSize="11"
                                           FontWeight="Medium" />
                            </StackPanel>
                        </Border>
                    </Grid>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>
</ResourceDictionary>