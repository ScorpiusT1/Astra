
    <ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                        xmlns:local="clr-namespace:Astra.UI.Controls">

    <!-- 节点控件样式 NodeControl       -->
    <!-- ============================= -->
    <Style TargetType="{x:Type local:NodeControl}">
        <Setter Property="Width"
                Value="220" />
        <Setter Property="Height"
                Value="40" />
        <Setter Property="Margin"
                Value="0,0,0,8" />
        <Setter Property="IconColor"
                Value="{DynamicResource PrimaryBrush}" />
        <!-- 禁用焦点视觉样式（去除虚线边框）-->
        <Setter Property="FocusVisualStyle"
                Value="{x:Null}" />
        <!-- 为整个控件设置 ToolTip -->
        <Setter Property="ToolTip"
                Value="{Binding RelativeSource={RelativeSource Self}, Path=Title}" />
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type local:NodeControl}">
                    <Grid>
                        <!-- 主节点容器 -->
                        <Border x:Name="NodeBorder"
                                Background="{DynamicResource SurfaceBrush}"
                                CornerRadius="6"
                                ClipToBounds="False">
                            <Border.Effect>
                                <DropShadowEffect Color="{DynamicResource ShadowColor}"
                                                  BlurRadius="4"
                                                  ShadowDepth="1"
                                                  Opacity="0.2" />
                            </Border.Effect>

                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="40" />
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>

                                <!-- 图标区域 -->
                                <Border Grid.Column="0"
                                        Background="{TemplateBinding IconColor}"
                                        CornerRadius="6,0,0,6">
                                    <Viewbox Width="20"
                                             Height="20"
                                             HorizontalAlignment="Center"
                                             VerticalAlignment="Center">
                                        <Canvas Width="24"
                                                Height="24">
                                            <Path x:Name="IconPath"
                                                  Data="{TemplateBinding IconData}"
                                                  Stroke="{DynamicResource SurfaceBrush}"
                                                  StrokeThickness="2"
                                                  StrokeLineJoin="Round"
                                                  StrokeStartLineCap="Round"
                                                  StrokeEndLineCap="Round" />
                                        </Canvas>
                                    </Viewbox>
                                </Border>

                                <!-- 文本区域（包含显示和编辑两种模式） -->
                                <Grid Grid.Column="1"
                                      Margin="10,0"
                                      Background="Transparent">
                                    <!-- 显示模式：TextBlock -->
                                    <TextBlock x:Name="PART_TitleTextBlock"
                                               Text="{TemplateBinding Title}"
                                               FontSize="13"
                                               VerticalAlignment="Center"
                                               TextTrimming="CharacterEllipsis"
                                               Foreground="{DynamicResource PrimaryTextBrush}"
                                               Cursor="IBeam"
                                               Background="Transparent" />

                                    <!-- 编辑模式：TextBox -->
                                    <TextBox x:Name="PART_EditTextBox"
                                          
                                             FontSize="13"
                                             VerticalAlignment="Center"
                                             VerticalContentAlignment="Center"
                                             BorderThickness="1"
                                             BorderBrush="{DynamicResource PrimaryBrush}"
                                             Foreground="{DynamicResource PrimaryTextBrush}"
                                             Padding="2"
                                             Visibility="Collapsed" />
                                </Grid>

                                <!-- 时间区域 -->
                                <TextBlock Grid.Column="2"
                                           Text="{TemplateBinding ExecutionTime}"
                                           FontSize="12"
                                           VerticalAlignment="Center"
                                           Margin="0,0,12,0"
                                           Foreground="{DynamicResource SecondaryTextBrush}" />
                            </Grid>
                        </Border>

                        <!-- 四个端口 -->
                        <local:PortControl x:Name="PortTop"
                                           HorizontalAlignment="Center"
                                           VerticalAlignment="Top"
                                           Margin="0,-5,0,0"
                                           Opacity="0" />

                        <local:PortControl x:Name="PortBottom"
                                           HorizontalAlignment="Center"
                                           VerticalAlignment="Bottom"
                                           Margin="0,0,0,-5"
                                           Opacity="0" />

                        <local:PortControl x:Name="PortLeft"
                                           HorizontalAlignment="Left"
                                           VerticalAlignment="Center"
                                           Margin="-5,0,0,0"
                                           Opacity="0" />

                        <local:PortControl x:Name="PortRight"
                                           HorizontalAlignment="Right"
                                           VerticalAlignment="Center"
                                           Margin="0,0,-5,0"
                                           Opacity="0" />
                    </Grid>

                    <ControlTemplate.Triggers>
                        <!-- 显示端口 -->
                        <Trigger Property="ShowPorts"
                                 Value="True">
                            <Trigger.EnterActions>
                                <BeginStoryboard>
                                    <Storyboard>
                                        <DoubleAnimation Storyboard.TargetName="PortTop"
                                                         Storyboard.TargetProperty="Opacity"
                                                         To="1"
                                                         Duration="0:0:0.2" />
                                        <DoubleAnimation Storyboard.TargetName="PortBottom"
                                                         Storyboard.TargetProperty="Opacity"
                                                         To="1"
                                                         Duration="0:0:0.2" />
                                        <DoubleAnimation Storyboard.TargetName="PortLeft"
                                                         Storyboard.TargetProperty="Opacity"
                                                         To="1"
                                                         Duration="0:0:0.2" />
                                        <DoubleAnimation Storyboard.TargetName="PortRight"
                                                         Storyboard.TargetProperty="Opacity"
                                                         To="1"
                                                         Duration="0:0:0.2" />
                                    </Storyboard>
                                </BeginStoryboard>
                            </Trigger.EnterActions>
                            <Trigger.ExitActions>
                                <BeginStoryboard>
                                    <Storyboard>
                                        <DoubleAnimation Storyboard.TargetName="PortTop"
                                                         Storyboard.TargetProperty="Opacity"
                                                         To="0"
                                                         Duration="0:0:0.2" />
                                        <DoubleAnimation Storyboard.TargetName="PortBottom"
                                                         Storyboard.TargetProperty="Opacity"
                                                         To="0"
                                                         Duration="0:0:0.2" />
                                        <DoubleAnimation Storyboard.TargetName="PortLeft"
                                                         Storyboard.TargetProperty="Opacity"
                                                         To="0"
                                                         Duration="0:0:0.2" />
                                        <DoubleAnimation Storyboard.TargetName="PortRight"
                                                         Storyboard.TargetProperty="Opacity"
                                                         To="0"
                                                         Duration="0:0:0.2" />
                                    </Storyboard>
                                </BeginStoryboard>
                            </Trigger.ExitActions>
                        </Trigger>
                        
                        <!-- 选中状态：添加高亮边框 -->
                        <Trigger Property="IsSelected"
                                 Value="True">
                            <Setter TargetName="NodeBorder"
                                    Property="BorderBrush"
                                    Value="{DynamicResource PrimaryBrush}" />
                            <Setter TargetName="NodeBorder"
                                    Property="BorderThickness"
                                    Value="2" />
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>
</ResourceDictionary>