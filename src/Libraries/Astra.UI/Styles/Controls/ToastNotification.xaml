<Window x:Class="Astra.UI.Styles.Controls.ToastNotification"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:Astra.UI.Styles.Controls"
        mc:Ignorable="d"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        ShowInTaskbar="False"
        SizeToContent="WidthAndHeight"
        ResizeMode="NoResize"
        WindowStartupLocation="Manual"
        Topmost="True"
        Loaded="Window_Loaded">

    <Window.Resources>
        <!-- 图标按钮样式 -->
        <Style x:Key="IconButtonStyle"
               TargetType="Button">
            <Setter Property="Background"
                    Value="Transparent" />
            <Setter Property="BorderThickness"
                    Value="0" />
            <Setter Property="Cursor"
                    Value="Hand" />
            <Setter Property="Padding"
                    Value="4" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                CornerRadius="4"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center"
                                              VerticalAlignment="Center" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver"
                                     Value="True">
                                <Setter TargetName="border"
                                        Property="Background"
                                        Value="{DynamicResource ThirdlyRegionBrush}" />
                            </Trigger>
                            <Trigger Property="IsPressed"
                                     Value="True">
                                <Setter TargetName="border"
                                        Property="Background"
                                        Value="{DynamicResource SecondaryRegionBrush}" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- 入场动画：从右侧滑入 -->
        <Storyboard x:Key="SlideInAnimation">
            <DoubleAnimation Storyboard.TargetName="MainBorder"
                             Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.X)"
                             From="400"
                             To="0"
                             Duration="0:0:0.4">
                <DoubleAnimation.EasingFunction>
                    <BackEase EasingMode="EaseOut"
                              Amplitude="0.3" />
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
            <DoubleAnimation Storyboard.TargetName="MainBorder"
                             Storyboard.TargetProperty="Opacity"
                             From="0"
                             To="1"
                             Duration="0:0:0.3" />
        </Storyboard>

        <!-- 退场动画：向右侧滑出并淡出 -->
        <Storyboard x:Key="SlideOutAnimation"
                    Completed="SlideOutAnimation_Completed">
            <DoubleAnimation Storyboard.TargetName="MainBorder"
                             Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.X)"
                             To="400"
                             Duration="0:0:0.3">
                <DoubleAnimation.EasingFunction>
                    <QuadraticEase EasingMode="EaseIn" />
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
            <DoubleAnimation Storyboard.TargetName="MainBorder"
                             Storyboard.TargetProperty="Opacity"
                             To="0"
                             Duration="0:0:0.3" />
        </Storyboard>
    </Window.Resources>

    <Border x:Name="MainBorder"
            Background="{DynamicResource SurfaceBrush}"
            BorderBrush="{DynamicResource BorderBrush}"
            BorderThickness="1"
            CornerRadius="12"
            Padding="16,12"
            MinWidth="280"
            MaxWidth="500"
            Margin="0"
            RenderTransformOrigin="0.5,0.5"
            Loaded="MainBorder_Loaded">
        <Border.RenderTransform>
            <TranslateTransform X="0"
                                Y="0" />
        </Border.RenderTransform>
        <Border.Effect>
            <DropShadowEffect Color="{DynamicResource ShadowColor}"
                              Opacity="0.25"
                              BlurRadius="30"
                              ShadowDepth="8"
                              Direction="270" />
        </Border.Effect>

        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <!-- 左侧彩色边条 -->
            <Border Grid.Column="0"
                    Grid.ColumnSpan="3"
                    Width="4"
                    HorizontalAlignment="Left"
                    CornerRadius="12,0,0,12"
                    Margin="-16,-12,-16,-12">
                <Border.Background>
                    <SolidColorBrush x:Name="AccentBarBrush"
                                     Color="{DynamicResource PrimaryColor}" />
                </Border.Background>
            </Border>

            <!-- 图标区域 -->
            <Border Grid.Column="0"
                    Width="44"
                    Height="44"
                    CornerRadius="22"
                    Margin="0,0,14,0"
                    VerticalAlignment="Top">
                <Border.Background>
                    <SolidColorBrush x:Name="IconBackgroundBrush"
                                     Color="#2196F3"
                                     Opacity="0.12" />
                </Border.Background>

                <Viewbox Width="22"
                         Height="22">
                    <Canvas Width="24"
                            Height="24">
                        <Path x:Name="IconPath"
                              Data="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"
                              Fill="{DynamicResource InfoBrush}" />
                    </Canvas>
                </Viewbox>
            </Border>

            <!-- 消息内容 -->
            <ScrollViewer Grid.Column="1"
                          VerticalAlignment="Top"
                          Margin="4,0,0,0"
                          MaxHeight="300"
                          VerticalScrollBarVisibility="Auto"
                          HorizontalScrollBarVisibility="Disabled">
                <StackPanel>
                    <TextBlock x:Name="TitleText"
                               FontSize="15"
                               FontWeight="SemiBold"
                               Foreground="{DynamicResource PrimaryTextBrush}"
                               TextWrapping="Wrap"
                               Margin="0,0,0,6" />

                    <TextBlock x:Name="MessageText"
                               FontSize="13"
                               Foreground="{DynamicResource SecondaryTextBrush}"
                               TextWrapping="Wrap"
                               MaxWidth="380" />
                </StackPanel>
            </ScrollViewer>

            <!-- 关闭按钮 -->
            <Button Grid.Column="2"
                    Width="24"
                    Height="24"
                    Margin="12,0,0,0"
                    FontSize="12"
                    VerticalAlignment="Top"
                    Style="{StaticResource CloseButtonStyle}"
                    Click="CloseButton_Click"
                    ToolTip="关闭">
            </Button>

            <!-- 进度条 -->
            <Border Grid.Column="0"
                    Grid.ColumnSpan="3"
                    Height="4"
                    VerticalAlignment="Bottom"
                    Margin="-16,-12,-16,-12"
                    CornerRadius="0,0,12,12"
                    ClipToBounds="True"
                    Background="{DynamicResource ThirdlyRegionBrush}">
                <Border x:Name="ProgressBar"
                        HorizontalAlignment="Left"
                        CornerRadius="0,0,0,12"
                        Background="{DynamicResource PrimaryBrush}"
                        Opacity="0.8" />
            </Border>
        </Grid>
    </Border>
</Window>
