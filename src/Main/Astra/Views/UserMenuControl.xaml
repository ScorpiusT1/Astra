<UserControl x:Class="Astra.Views.UserMenuControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
            
             xmlns:converters="clr-namespace:Astra.Converters"
             xmlns:helpers="clr-namespace:Astra.UI.Helpers;assembly=Astra.UI"
             xmlns:utils="clr-namespace:Astra.Utilities"
             xmlns:viewmodels="clr-namespace:Astra.ViewModels"
             d:DataContext="{d:DesignInstance Type=viewmodels:UserMenuViewModel}"
             mc:Ignorable="d"
             Background="Transparent">
    <UserControl.Resources>
        <!-- 通用缓动资源 (需在使用前定义) -->
        <QuadraticEase x:Key="EaseOutQuad" EasingMode="EaseOut" />
        <BackEase x:Key="EaseOutBack_03" EasingMode="EaseOut" Amplitude="0.3" />
        <CubicEase x:Key="EaseOutCubic" EasingMode="EaseOut" />
        <SineEase x:Key="EaseInOutSine" EasingMode="EaseInOut" />
        <converters:UserRoleToStringConverter x:Key="UserRoleToStringConverter" />
        <converters:FirstLetterConverter x:Key="FirstLetterConverter" />
        <converters:UserRoleToColorConverter x:Key="UserRoleToColorConverter" />
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter" />

        <!-- 动画资源 -->
        <Storyboard x:Key="FadeInAnimation">
            <DoubleAnimation Storyboard.TargetProperty="Opacity"
                             From="0"
                             To="1"
                             Duration="0:0:0.2" />
            <ThicknessAnimation Storyboard.TargetProperty="Margin"
                                From="0,-5,0,0"
                                To="0,0,0,0"
                                Duration="0:0:0.2">
                <ThicknessAnimation.EasingFunction>
                    <StaticResource ResourceKey="EaseOutQuad" />
                </ThicknessAnimation.EasingFunction>
            </ThicknessAnimation>
        </Storyboard>

        

        <!-- 统一的菜单按钮模板（切换用户） -->
        <ControlTemplate x:Key="MenuActionButtonTemplate.SwitchUser" TargetType="Button">
            <Border x:Name="border"
                    Background="{TemplateBinding Background}"
                    CornerRadius="10"
                    Padding="14,0">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <Grid Grid.Column="0"
                          Width="36"
                          Height="36"
                          Margin="0,0,12,0">
                        <Ellipse x:Name="iconGlow"
                                 Fill="{DynamicResource PrimaryBrush}"
                                 Opacity="0"
                                 Margin="-4">
                            <Ellipse.RenderTransform>
                                <ScaleTransform x:Name="glowScale"
                                                ScaleX="1"
                                                ScaleY="1"
                                                CenterX="18"
                                                CenterY="18" />
                            </Ellipse.RenderTransform>
                        </Ellipse>

                        <Border x:Name="iconContainer"
                                CornerRadius="10"
                                Background="{DynamicResource LightPrimaryBrush}">
                            <Border.RenderTransform>
                                <ScaleTransform x:Name="iconScale"
                                                ScaleX="1"
                                                ScaleY="1"
                                                CenterX="18"
                                                CenterY="18" />
                            </Border.RenderTransform>
                            <Border.Effect>
                                <DropShadowEffect Color="{DynamicResource ShadowColor}"
                                                  Opacity="0.06"
                                                  BlurRadius="6"
                                                  ShadowDepth="2" />
                            </Border.Effect>
                            <Path x:Name="iconPath"
                                  Data="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"
                                  Fill="{DynamicResource PrimaryBrush}"
                                  Width="18"
                                  Height="18"
                                  Stretch="Uniform"
                                  HorizontalAlignment="Center"
                                  VerticalAlignment="Center" />
                        </Border>
                    </Grid>

                    <StackPanel Grid.Column="1"
                                VerticalAlignment="Center">
                        <TextBlock x:Name="titleText"
                                   Text="切换用户"
                                   FontSize="14"
                                   FontWeight="SemiBold"
                                   Foreground="{DynamicResource PrimaryTextBrush}" />
                        <TextBlock x:Name="subtitleText"
                                   Text="登录其他账号"
                                   FontSize="11"
                                   Foreground="{DynamicResource SecondaryTextBrush}"
                                   Margin="0,3,0,0" />
                    </StackPanel>

                    <Viewbox Grid.Column="2"
                             Width="16"
                             Height="16"
                             VerticalAlignment="Center"
                             Margin="8,0,0,0">
                        <Path x:Name="arrow"
                              Data="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"
                              Fill="{DynamicResource SecondaryTextBrush}"
                              Opacity="0"
                              Stretch="Uniform">
                            <Path.RenderTransform>
                                <TranslateTransform x:Name="arrowTransform"
                                                    X="0" />
                            </Path.RenderTransform>
                        </Path>
                    </Viewbox>
                </Grid>
            </Border>
            <ControlTemplate.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter TargetName="border" Property="Background" Value="{DynamicResource SecondaryRegionBrush}" />
                    <Setter TargetName="iconContainer" Property="Background" Value="{DynamicResource PrimaryBrush}" />
                    <Setter TargetName="iconPath" Property="Fill" Value="{DynamicResource ReverseTextBrush}" />
                    <Setter TargetName="iconGlow" Property="Opacity" Value="0.15" />
                    <Setter TargetName="titleText" Property="Foreground" Value="{DynamicResource PrimaryBrush}" />
                    <Setter TargetName="arrow" Property="Opacity" Value="1" />
                    <Setter TargetName="arrow" Property="Fill" Value="{DynamicResource PrimaryBrush}" />
                    <Trigger.EnterActions>
                        <BeginStoryboard>
                            <Storyboard>
                                <DoubleAnimation Storyboard.TargetName="iconScale" Storyboard.TargetProperty="ScaleX" To="1.08" Duration="0:0:0.2">
                                    <DoubleAnimation.EasingFunction>
                                        <StaticResource ResourceKey="EaseOutQuad" />
                                    </DoubleAnimation.EasingFunction>
                                </DoubleAnimation>
                                <DoubleAnimation Storyboard.TargetName="iconScale" Storyboard.TargetProperty="ScaleY" To="1.08" Duration="0:0:0.2">
                                    <DoubleAnimation.EasingFunction>
                                        <StaticResource ResourceKey="EaseOutQuad" />
                                    </DoubleAnimation.EasingFunction>
                                </DoubleAnimation>
                                <DoubleAnimation Storyboard.TargetName="arrowTransform" Storyboard.TargetProperty="X" To="3" Duration="0:0:0.2">
                                    <DoubleAnimation.EasingFunction>
                                        <StaticResource ResourceKey="EaseOutQuad" />
                                    </DoubleAnimation.EasingFunction>
                                </DoubleAnimation>
                            </Storyboard>
                        </BeginStoryboard>
                    </Trigger.EnterActions>
                    <Trigger.ExitActions>
                        <BeginStoryboard>
                            <Storyboard>
                                <DoubleAnimation Storyboard.TargetName="iconScale" Storyboard.TargetProperty="ScaleX" To="1" Duration="0:0:0.2" />
                                <DoubleAnimation Storyboard.TargetName="iconScale" Storyboard.TargetProperty="ScaleY" To="1" Duration="0:0:0.2" />
                                <DoubleAnimation Storyboard.TargetName="arrowTransform" Storyboard.TargetProperty="X" To="0" Duration="0:0:0.2" />
                            </Storyboard>
                        </BeginStoryboard>
                    </Trigger.ExitActions>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter TargetName="border" Property="Background" Value="{DynamicResource ThirdlyRegionBrush}" />
                    <Setter TargetName="iconContainer" Property="Background" Value="{DynamicResource DarkPrimaryBrush}" />
                    <Setter TargetName="border" Property="RenderTransform">
                        <Setter.Value>
                            <ScaleTransform ScaleX="0.97" ScaleY="0.97" />
                        </Setter.Value>
                    </Setter>
                </Trigger>
            </ControlTemplate.Triggers>
        </ControlTemplate>

        <!-- 统一的菜单按钮模板（修改密码） -->
        <ControlTemplate x:Key="MenuActionButtonTemplate.ChangePassword" TargetType="Button">
            <Border x:Name="border" Background="{TemplateBinding Background}" CornerRadius="10" Padding="14,0">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <Grid Grid.Column="0" Width="36" Height="36" Margin="0,0,12,0">
                        <Ellipse x:Name="iconGlow" Fill="{DynamicResource InfoBrush}" Opacity="0" Margin="-4">
                            <Ellipse.RenderTransform>
                                <ScaleTransform x:Name="glowScale" ScaleX="1" ScaleY="1" CenterX="18" CenterY="18" />
                            </Ellipse.RenderTransform>
                        </Ellipse>

                        <Border x:Name="iconContainer" CornerRadius="10" Background="{DynamicResource LightInfoBrush}">
                            <Border.RenderTransform>
                                <ScaleTransform x:Name="iconScale" ScaleX="1" ScaleY="1" CenterX="18" CenterY="18" />
                            </Border.RenderTransform>
                            <Border.Effect>
                                <DropShadowEffect Color="{DynamicResource ShadowColor}" Opacity="0.06" BlurRadius="6" ShadowDepth="2" />
                            </Border.Effect>
                            <Path x:Name="iconPath" Data="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zM9 6c0-1.66 1.34-3 3-3s3 1.34 3 3v2H9V6zm9 14H6V10h12v10zm-6-3c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2z" Fill="{DynamicResource InfoBrush}" Width="18" Height="18" Stretch="Uniform" HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                    </Grid>

                    <StackPanel Grid.Column="1" VerticalAlignment="Center">
                        <TextBlock x:Name="titleText" Text="修改密码" FontSize="14" FontWeight="SemiBold" Foreground="{DynamicResource PrimaryTextBrush}" />
                        <TextBlock x:Name="subtitleText" Text="更新账户密码" FontSize="11" Foreground="{DynamicResource SecondaryTextBrush}" Margin="0,3,0,0" />
                    </StackPanel>

                    <Viewbox Grid.Column="2" Width="16" Height="16" VerticalAlignment="Center" Margin="8,0,0,0">
                        <Path x:Name="arrow" Data="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z" Fill="{DynamicResource SecondaryTextBrush}" Opacity="0" Stretch="Uniform">
                            <Path.RenderTransform>
                                <TranslateTransform x:Name="arrowTransform" X="0" />
                            </Path.RenderTransform>
                        </Path>
                    </Viewbox>
                </Grid>
            </Border>
            <ControlTemplate.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter TargetName="border" Property="Background" Value="{DynamicResource SecondaryRegionBrush}" />
                    <Setter TargetName="iconContainer" Property="Background" Value="{DynamicResource InfoBrush}" />
                    <Setter TargetName="iconPath" Property="Fill" Value="{DynamicResource ReverseTextBrush}" />
                    <Setter TargetName="iconGlow" Property="Opacity" Value="0.15" />
                    <Setter TargetName="titleText" Property="Foreground" Value="{DynamicResource InfoBrush}" />
                    <Setter TargetName="arrow" Property="Opacity" Value="1" />
                    <Setter TargetName="arrow" Property="Fill" Value="{DynamicResource InfoBrush}" />
                    <Trigger.EnterActions>
                        <BeginStoryboard>
                            <Storyboard>
                                <DoubleAnimation Storyboard.TargetName="iconScale" Storyboard.TargetProperty="ScaleX" To="1.08" Duration="0:0:0.2">
                                    <DoubleAnimation.EasingFunction>
                                        <StaticResource ResourceKey="EaseOutQuad" />
                                    </DoubleAnimation.EasingFunction>
                                </DoubleAnimation>
                                <DoubleAnimation Storyboard.TargetName="iconScale" Storyboard.TargetProperty="ScaleY" To="1.08" Duration="0:0:0.2">
                                    <DoubleAnimation.EasingFunction>
                                        <StaticResource ResourceKey="EaseOutQuad" />
                                    </DoubleAnimation.EasingFunction>
                                </DoubleAnimation>
                                <DoubleAnimation Storyboard.TargetName="arrowTransform" Storyboard.TargetProperty="X" To="3" Duration="0:0:0.2">
                                    <DoubleAnimation.EasingFunction>
                                        <StaticResource ResourceKey="EaseOutQuad" />
                                    </DoubleAnimation.EasingFunction>
                                </DoubleAnimation>
                            </Storyboard>
                        </BeginStoryboard>
                    </Trigger.EnterActions>
                    <Trigger.ExitActions>
                        <BeginStoryboard>
                            <Storyboard>
                                <DoubleAnimation Storyboard.TargetName="iconScale" Storyboard.TargetProperty="ScaleX" To="1" Duration="0:0:0.2" />
                                <DoubleAnimation Storyboard.TargetName="iconScale" Storyboard.TargetProperty="ScaleY" To="1" Duration="0:0:0.2" />
                                <DoubleAnimation Storyboard.TargetName="arrowTransform" Storyboard.TargetProperty="X" To="0" Duration="0:0:0.2" />
                            </Storyboard>
                        </BeginStoryboard>
                    </Trigger.ExitActions>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter TargetName="border" Property="Background" Value="{DynamicResource ThirdlyRegionBrush}" />
                    <Setter TargetName="iconContainer" Property="Background" Value="{DynamicResource DarkInfoBrush}" />
                    <Setter TargetName="border" Property="RenderTransform">
                        <Setter.Value>
                            <ScaleTransform ScaleX="0.97" ScaleY="0.97" />
                        </Setter.Value>
                    </Setter>
                </Trigger>
            </ControlTemplate.Triggers>
        </ControlTemplate>

        <!-- 统一的菜单按钮模板（退出登录） -->
        <ControlTemplate x:Key="MenuActionButtonTemplate.Logout" TargetType="Button">
            <Border x:Name="border" Background="{TemplateBinding Background}" CornerRadius="10" Padding="14,0">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <Grid Grid.Column="0" Width="36" Height="36" Margin="0,0,12,0">
                        <Ellipse x:Name="iconGlow" Fill="{DynamicResource DangerBrush}" Opacity="0" Margin="-4">
                            <Ellipse.RenderTransform>
                                <ScaleTransform x:Name="glowScale" ScaleX="1" ScaleY="1" CenterX="18" CenterY="18" />
                            </Ellipse.RenderTransform>
                        </Ellipse>

                        <Border x:Name="iconContainer" CornerRadius="10" Background="{DynamicResource LightDangerBrush}">
                            <Border.RenderTransform>
                                <ScaleTransform x:Name="iconScale" ScaleX="1" ScaleY="1" CenterX="18" CenterY="18" />
                            </Border.RenderTransform>
                            <Border.Effect>
                                <DropShadowEffect Color="{DynamicResource DangerColor}" Opacity="0.08" BlurRadius="6" ShadowDepth="2" />
                            </Border.Effect>
                            <Path x:Name="iconPath" Data="M17 8l-1.41 1.41L17.17 11H9v2h8.17l-1.58 1.58L17 16l4-4-4-4zM5 5h7V3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h7v-2H5V5z" Fill="{DynamicResource DangerBrush}" Width="18" Height="18" Stretch="Uniform" HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                    </Grid>

                    <StackPanel Grid.Column="1" VerticalAlignment="Center">
                        <TextBlock x:Name="titleText" Text="退出登录" FontSize="14" FontWeight="SemiBold" Foreground="{DynamicResource DangerBrush}" />
                        <TextBlock x:Name="subtitleText" Text="注销当前账户" FontSize="11" Foreground="{DynamicResource SecondaryTextBrush}" Margin="0,3,0,0" />
                    </StackPanel>

                    <Viewbox Grid.Column="2" Width="16" Height="16" VerticalAlignment="Center" Margin="8,0,0,0">
                        <Path x:Name="arrow" Data="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z" Fill="{DynamicResource DangerBrush}" Opacity="0" Stretch="Uniform">
                            <Path.RenderTransform>
                                <TranslateTransform x:Name="arrowTransform" X="0" />
                            </Path.RenderTransform>
                        </Path>
                    </Viewbox>
                </Grid>
            </Border>
            <ControlTemplate.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter TargetName="border" Property="Background" Value="{DynamicResource LightDangerBrush}" />
                    <Setter TargetName="iconContainer" Property="Background" Value="{DynamicResource DangerBrush}" />
                    <Setter TargetName="iconPath" Property="Fill" Value="{DynamicResource ReverseTextBrush}" />
                    <Setter TargetName="iconGlow" Property="Opacity" Value="0.15" />
                    <Setter TargetName="titleText" Property="Foreground" Value="{DynamicResource DangerBrush}" />
                    <Setter TargetName="arrow" Property="Opacity" Value="1" />
                    <Trigger.EnterActions>
                        <BeginStoryboard>
                            <Storyboard>
                                <DoubleAnimation Storyboard.TargetName="iconScale" Storyboard.TargetProperty="ScaleX" To="1.08" Duration="0:0:0.2">
                                    <DoubleAnimation.EasingFunction>
                                        <StaticResource ResourceKey="EaseOutQuad" />
                                    </DoubleAnimation.EasingFunction>
                                </DoubleAnimation>
                                <DoubleAnimation Storyboard.TargetName="iconScale" Storyboard.TargetProperty="ScaleY" To="1.08" Duration="0:0:0.2">
                                    <DoubleAnimation.EasingFunction>
                                        <StaticResource ResourceKey="EaseOutQuad" />
                                    </DoubleAnimation.EasingFunction>
                                </DoubleAnimation>
                                <DoubleAnimation Storyboard.TargetName="arrowTransform" Storyboard.TargetProperty="X" To="3" Duration="0:0:0.2">
                                    <DoubleAnimation.EasingFunction>
                                        <StaticResource ResourceKey="EaseOutQuad" />
                                    </DoubleAnimation.EasingFunction>
                                </DoubleAnimation>
                            </Storyboard>
                        </BeginStoryboard>
                    </Trigger.EnterActions>
                    <Trigger.ExitActions>
                        <BeginStoryboard>
                            <Storyboard>
                                <DoubleAnimation Storyboard.TargetName="iconScale" Storyboard.TargetProperty="ScaleX" To="1" Duration="0:0:0.2" />
                                <DoubleAnimation Storyboard.TargetName="iconScale" Storyboard.TargetProperty="ScaleY" To="1" Duration="0:0:0.2" />
                                <DoubleAnimation Storyboard.TargetName="arrowTransform" Storyboard.TargetProperty="X" To="0" Duration="0:0:0.2" />
                            </Storyboard>
                        </BeginStoryboard>
                    </Trigger.ExitActions>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter TargetName="border" Property="Background" Value="{DynamicResource DangerBrush}" />
                    <Setter TargetName="iconContainer" Property="Background" Value="{DynamicResource DarkDangerBrush}" />
                    <Setter TargetName="titleText" Property="Foreground" Value="{DynamicResource ReverseTextBrush}" />
                    <Setter TargetName="subtitleText" Property="Foreground" Value="{DynamicResource ReverseTextBrush}" />
                    <Setter TargetName="arrow" Property="Fill" Value="{DynamicResource ReverseTextBrush}" />
                    <Setter TargetName="border" Property="RenderTransform">
                        <Setter.Value>
                            <ScaleTransform ScaleX="0.97" ScaleY="0.97" />
                        </Setter.Value>
                    </Setter>
                </Trigger>
            </ControlTemplate.Triggers>
        </ControlTemplate>
    </UserControl.Resources>

    <UserControl.Triggers>
        <EventTrigger RoutedEvent="Loaded">
            <BeginStoryboard Storyboard="{StaticResource FadeInAnimation}" />
        </EventTrigger>
    </UserControl.Triggers>

    <!-- 用户菜单弹出面板 -->
    <Border x:Name="MainBorder"
            Background="{DynamicResource SurfaceBrush}"
            CornerRadius="16"
            BorderBrush="{DynamicResource BorderBrush}"
            BorderThickness="1"
            Padding="12"
            MinWidth="280"
            MaxWidth="300"
            helpers:BorderClipHelper.ClipToBounds="True">

        <!-- 增强阴影效果 - 更现代的多层阴影 -->
        <Border.Effect>
            <DropShadowEffect Color="{DynamicResource ShadowColor}"
                              Opacity="0.15"
                              BlurRadius="32"
                              ShadowDepth="8"
                              Direction="270" />
        </Border.Effect>

        <StackPanel>
            <!-- 用户信息卡片 - 更加精致的头部区域 -->
            <Border CornerRadius="12"
                    Padding="16,14"
                    Margin="0,0,0,8"
                    Background="{DynamicResource SecondaryRegionBrush}">
                <Border.Effect>
                    <DropShadowEffect Color="{DynamicResource ShadowColor}"
                                      Opacity="0.03"
                                      BlurRadius="8"
                                      ShadowDepth="2" />
                </Border.Effect>

                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <!-- 头像容器 - 增强视觉效果 -->
                    <Grid Grid.Column="0"
                          Width="52"
                          Height="52"
                          Margin="0,0,14,0"
                          VerticalAlignment="Center">
                        <!-- 外圈光晕效果 -->
                        <Ellipse Fill="{DynamicResource PrimaryBrush}"
                                 Opacity="0.08"
                                 Margin="-4" />

                        <!-- 主体头像 -->
                        <Border CornerRadius="12">
                            <!-- 渐变背景 -->
                            <Border.Background>
                                <LinearGradientBrush StartPoint="0,0"
                                                     EndPoint="1,1">
                                    <GradientStop Color="{DynamicResource PrimaryColor}"
                                                  Offset="0" />
                                    <GradientStop Color="{DynamicResource DarkPrimaryColor}"
                                                  Offset="1" />
                                </LinearGradientBrush>
                            </Border.Background>
                            <!-- 增强阴影 -->
                            <Border.Effect>
                                <DropShadowEffect Color="{DynamicResource PrimaryColor}"
                                                  Opacity="0.3"
                                                  BlurRadius="12"
                                                  ShadowDepth="3" />
                            </Border.Effect>
                            <TextBlock Text="{Binding CurrentUserName, Converter={StaticResource FirstLetterConverter}}"
                                       FontSize="24"
                                       FontWeight="Bold"
                                       Foreground="{DynamicResource ReverseTextBrush}"
                                       HorizontalAlignment="Center"
                                       VerticalAlignment="Center" />
                        </Border>

                        <!-- 在线状态指示器 -->
                        <Border Width="14"
                                Height="14"
                                CornerRadius="7"
                                Background="{DynamicResource SuccessBrush}"
                                BorderBrush="{DynamicResource SurfaceBrush}"
                                BorderThickness="2"
                                HorizontalAlignment="Right"
                                VerticalAlignment="Bottom"
                                Margin="0,0,-2,-2">
                            <Border.Effect>
                                <DropShadowEffect Color="{DynamicResource SuccessColor}"
                                                  Opacity="0.4"
                                                  BlurRadius="8"
                                                  ShadowDepth="0" />
                            </Border.Effect>
                        </Border>
                    </Grid>

                    <!-- 用户信息 -->
                    <StackPanel Grid.Column="1"
                                VerticalAlignment="Center">
                        <TextBlock Text="{Binding CurrentUserName}"
                                   FontSize="15"
                                   FontWeight="Bold"
                                   Foreground="{DynamicResource PrimaryTextBrush}"
                                   Margin="0,0,0,6"
                                   TextTrimming="CharacterEllipsis" />

                        <!-- 角色标签 - 更精致的设计 -->
                        <Border CornerRadius="6"
                                Padding="10,4"
                                HorizontalAlignment="Left">
                            <Border.Background>
                                <LinearGradientBrush StartPoint="0,0"
                                                     EndPoint="1,0">
                                    <GradientStop Color="{DynamicResource WarningColor}"
                                                  Offset="0" />
                                    <GradientStop Color="{DynamicResource DarkWarningColor}"
                                                  Offset="1" />
                                </LinearGradientBrush>
                            </Border.Background>
                            <Border.Effect>
                                <DropShadowEffect Color="{DynamicResource WarningColor}"
                                                  Opacity="0.2"
                                                  BlurRadius="6"
                                                  ShadowDepth="1" />
                            </Border.Effect>
                            <StackPanel Orientation="Horizontal">
                                <Ellipse Width="6"
                                         Height="6"
                                         Fill="{DynamicResource ReverseTextBrush}"
                                         Opacity="0.9"
                                         VerticalAlignment="Center"
                                         Margin="0,0,6,0" />
                                <TextBlock Text="{Binding CurrentUserRole, Converter={StaticResource UserRoleToStringConverter}}"
                                           FontSize="11"
                                           FontWeight="Bold"
                                           Foreground="{DynamicResource ReverseTextBrush}" />
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- 优雅的分隔线 -->
            <Border Height="1"
                    Margin="4,4,4,8">
                <Border.Background>
                    <LinearGradientBrush StartPoint="0,0.5"
                                         EndPoint="1,0.5">
                        <GradientStop Color="Transparent"
                                      Offset="0" />
                        <GradientStop Color="{DynamicResource BorderColor}"
                                      Offset="0.5" />
                        <GradientStop Color="Transparent"
                                      Offset="1" />
                    </LinearGradientBrush>
                </Border.Background>
            </Border>

            <!-- 菜单操作按钮区 -->
            <StackPanel Margin="0,0,0,0">
                <!-- 切换用户按钮 -->
                <Button Command="{Binding SwitchUserCommand}"
                        Background="Transparent"
                        BorderThickness="0"
                        Cursor="Hand"
                        Padding="0"
                        Height="54"
                        Margin="0,0,0,6"
                        HorizontalContentAlignment="Stretch"
                        VerticalContentAlignment="Stretch"
                        Template="{StaticResource MenuActionButtonTemplate.SwitchUser}" />

                <!-- 修改密码按钮 -->
                <Button Command="{Binding ChangePasswordCommand}"
                        Background="Transparent"
                        BorderThickness="0"
                        Cursor="Hand"
                        Height="54"
                        Padding="0"
                        Margin="0,0,0,6"
                        HorizontalContentAlignment="Stretch"
                        VerticalContentAlignment="Stretch"
                        Template="{StaticResource MenuActionButtonTemplate.ChangePassword}" />

                <!-- 优雅的分隔线 -->
                <Border Height="1"
                        Margin="4,2,4,8">
                    <Border.Background>
                        <LinearGradientBrush StartPoint="0,0.5"
                                             EndPoint="1,0.5">
                            <GradientStop Color="Transparent"
                                          Offset="0" />
                            <GradientStop Color="{DynamicResource BorderColor}"
                                          Offset="0.5" />
                            <GradientStop Color="Transparent"
                                          Offset="1" />
                        </LinearGradientBrush>
                    </Border.Background>
                </Border>

                <!-- 退出登录按钮 - 危险操作样式 -->
                <Button Command="{Binding LogoutCommand}"
                        Background="Transparent"
                        BorderThickness="0"
                        Cursor="Hand"
                        Height="54"
                        Padding="0"
                        Margin="0,0,0,0"
                        HorizontalContentAlignment="Stretch"
                        VerticalContentAlignment="Stretch"
                        Template="{StaticResource MenuActionButtonTemplate.Logout}" />
            </StackPanel>
        </StackPanel>
    </Border>
</UserControl>